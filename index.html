<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>商场品牌招聘信息</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#64748b',
                        neutral: '#f1f5f9',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .job-card {
                @apply bg-white rounded-lg shadow-sm overflow-hidden mb-4 border border-gray-100 transition-all duration-200 hover:shadow-md;
            }
            .card-header {
                @apply bg-primary/5 px-5 py-3 border-b border-gray-100;
            }
            .info-group {
                @apply grid grid-cols-2 gap-x-4 gap-y-3;
            }
            .info-item {
                @apply flex items-center;
            }
            .info-icon {
                @apply w-4 text-primary mr-2 flex-shrink-0;
            }
            .info-text {
                @apply text-sm;
            }
            .section-title {
                @apply text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2;
            }
            .pagination-btn {
                @apply px-3 py-1.5 rounded border border-gray-200 bg-white text-gray-700 text-sm hover:bg-primary hover:text-white hover:border-primary transition-colors;
            }
            .pagination-btn.active {
                @apply bg-primary text-white border-primary;
            }
            .pagination-btn:disabled {
                @apply opacity-50 cursor-not-allowed hover:bg-white hover:text-gray-700 hover:border-gray-200;
            }
            .loading {
                @apply text-center py-10 text-gray-500;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
    <!-- 顶部导航 -->
    <header class="bg-primary text-white shadow-md sticky top-0 z-10">
        <div class="container mx-auto px-5 py-4">
            <h1 class="text-xl font-bold text-center">商场品牌招聘信息</h1>
            <p class="text-center text-blue-100 text-xs mt-1">
                实时更新 · 官方发布
            </p>
        </div>
    </header>

    <!-- 主要内容区 -->
    <main class="container mx-auto px-4 py-5">
        <!-- 统计信息条 -->
        <div class="bg-white rounded-lg shadow-sm p-3 mb-5 border border-gray-100">
            <div class="flex justify-between items-center">
                <div class="text-sm text-gray-600">
                    <i class="fa fa-briefcase text-primary mr-1"></i>
                    共 <span id="total-jobs" class="font-medium text-primary">0</span> 个有效岗位
                </div>
                <div class="text-sm text-gray-500" id="update-time"></div>
            </div>
        </div>

        <!-- 招聘信息容器 -->
        <div id="jobs-container">
            <!-- 加载状态 -->
            <div class="loading">
                <i class="fa fa-spinner fa-spin mr-2"></i> 正在加载招聘信息...
            </div>
        </div>

        <!-- 分页控件 -->
        <div class="flex justify-center items-center mt-6 mb-4 gap-1 flex-wrap" id="pagination" style="display: none;">
            <button id="prev-page" class="pagination-btn" disabled>
                <i class="fa fa-angle-left"></i> 上一页
            </button>
            <div id="page-numbers" class="flex gap-1"></div>
            <button id="next-page" class="pagination-btn">
                下一页 <i class="fa fa-angle-right"></i>
            </button>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white border-t border-gray-200 py-4 mt-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-500 text-xs">© 2023 商场管理中心 | 本招聘信息由各品牌商铺提供</p>
        </div>
    </footer>

    <script>
        // 分页配置
        const PAGE_SIZE = 8; // 每页显示8条
        let currentPage = 1;
        let totalPages = 1;
        let jobsData = []; // 存储从腾讯文档获取的招聘数据

        // DOM元素
        const jobsContainer = document.getElementById('jobs-container');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const pageNumbersContainer = document.getElementById('page-numbers');
        const totalJobsEl = document.getElementById('total-jobs');
        const updateTimeEl = document.getElementById('update-time');
        const paginationContainer = document.getElementById('pagination');

        // 腾讯文档配置（已根据你的文档填写）
        const SHEET_ID = 'DZUxDYXBpU3FMbE5m';  // 你的文档ID
        const SHEET_TAB = 'BB08J2';            // 你的工作表ID

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 从腾讯文档获取数据（带跨域代理）
            fetchTencentDocData();
        });

        // 从腾讯文档获取数据（带跨域代理）
        async function fetchTencentDocData() {
            try {
                // 1. 腾讯文档API地址
                const tencentDocApi = `https://docs.qq.com/dop-api/v2/doc/get_entities?docid=${SHEET_ID}&tab=${SHEET_TAB}`;
                
                // 2. 添加跨域代理（解决浏览器跨域限制）
                // 备用代理：https://api.allorigins.win/get?url=${encodeURIComponent(tencentDocApi)}
                const proxyUrl = `https://cors.bridged.cc/${tencentDocApi}`;
                
                // 3. 通过代理请求数据
                const response = await fetch(proxyUrl);
                
                if (!response.ok) {
                    throw new Error('获取数据失败，状态码：' + response.status);
                }
                
                // 4. 解析返回数据（不同代理返回格式不同，这里适配cors.bridged.cc）
                const data = await response.json();
                
                // 5. 转换数据格式（适配你的腾讯文档字段）
                jobsData = parseTencentDocData(data);
                
                // 6. 更新页面显示
                totalJobsEl.textContent = jobsData.length;
                const now = new Date();
                updateTimeEl.textContent = `更新于: ${now.toLocaleString('zh-CN')}`;
                totalPages = Math.ceil(jobsData.length / PAGE_SIZE);
                initPagination();
                displayPage(currentPage);
                paginationContainer.style.display = 'flex';
                bindPaginationEvents();
                
            } catch (error) {
                console.error('获取数据出错:', error);
                jobsContainer.innerHTML = `
                    <div class="text-center py-10 text-red-500">
                        <i class="fa fa-exclamation-circle mr-2"></i> 加载失败，请稍后重试
                    </div>
                `;
            }
        }

        // 解析腾讯文档数据（关键：匹配你的A-J列字段）
        function parseTencentDocData(rawData) {
            try {
                // 从原始数据中提取表格行（跳过表头行）
                const rows = rawData.data.sheetData[0].rowData || [];
                const jobs = [];
                
                // 遍历行数据（从第2行开始，索引=1）
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (!row || !row.cellData) continue;
                    
                    // 提取单元格数据（A-J列对应索引0-9）
                    const cells = row.cellData.map(cell => cell.str || '');
                    
                    // 只添加"审核状态"为"通过"的岗位（J列=索引9）
                    if (cells[9] === '通过') {
                        jobs.push({
                            brand: cells[0] || '未填写',               // A列：品牌名称
                            position: cells[1] || '未填写',            // B列：招聘岗位
                            responsibilities: cells[2] || '无',        // C列：岗位职责
                            requirements: cells[3] || '无',            // D列：岗位要求
                            salary: cells[4] || '未填写',              // E列：薪资范围
                            location: cells[5] || '未填写',            // F列：工作地点
                            contactPerson: cells[6] || '未填写',       // G列：联系人
                            contactPhone: cells[7] || '未填写',        // H列：联系电话
                            expiryDate: cells[8] || '未填写',          // I列：有效期截止日期
                            auditStatus: cells[9] || '未审核'          // J列：审核状态
                        });
                    }
                }
                return jobs;
            } catch (error) {
                console.error('数据解析错误:', error);
                return [];
            }
        }

        // 初始化分页控件
        function initPagination() {
            pageNumbersContainer.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.dataset.page = i;
                pageNumbersContainer.appendChild(pageBtn);
            }
            updatePaginationButtons();
        }

        // 绑定分页事件
        function bindPaginationEvents() {
            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayPage(currentPage);
                    updatePaginationButtons();
                    scrollToTop();
                }
            });
            
            nextPageBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    displayPage(currentPage);
                    updatePaginationButtons();
                    scrollToTop();
                }
            });
            
            pageNumbersContainer.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' && e.target.dataset.page) {
                    const page = parseInt(e.target.dataset.page);
                    if (page !== currentPage) {
                        currentPage = page;
                        displayPage(currentPage);
                        updatePaginationButtons();
                        scrollToTop();
                    }
                }
            });
        }

        // 更新分页按钮状态
        function updatePaginationButtons() {
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            document.querySelectorAll('#page-numbers button').forEach(btn => {
                const page = parseInt(btn.dataset.page);
                btn.classList.toggle('active', page === currentPage);
            });
        }

        // 显示指定页的招聘信息
        function displayPage(page) {
            jobsContainer.innerHTML = '';
            
            if (jobsData.length === 0) {
                jobsContainer.innerHTML = `
                    <div class="text-center py-10 text-gray-500">
                        <i class="fa fa-info-circle mr-2"></i> 暂无有效招聘信息
                    </div>
                `;
                return;
            }
            
            const startIndex = (page - 1) * PAGE_SIZE;
            const endIndex = Math.min(startIndex + PAGE_SIZE, jobsData.length);
            const currentPageData = jobsData.slice(startIndex, endIndex);
            
            currentPageData.forEach(job => {
                const jobElement = createJobElement(job);
                jobsContainer.appendChild(jobElement);
            });
        }

        // 创建单个招聘信息元素
        function createJobElement(job) {
            const jobDiv = document.createElement('div');
            jobDiv.className = 'job-card';

            // 转换岗位职责为列表
            const responsibilitiesList = job.responsibilities
                .split(/[；;]/)
                .filter(item => item.trim() !== '')
                .map(item => `<li class="text-sm text-gray-700 mb-1">${item}</li>`)
                .join('');

            // 转换岗位要求为列表
            const requirementsList = job.requirements
                .split(/[；;]/)
                .filter(item => item.trim() !== '')
                .map(item => `<li class="text-sm text-gray-700 mb-1">${item}</li>`)
                .join('');

            jobDiv.innerHTML = `
                <div class="card-header">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-primary font-bold">${job.brand}</h3>
                            <p class="text-gray-800 mt-0.5">${job.position}</p>
                        </div>
                        <span class="bg-green-100 text-green-800 text-xs px-2 py-0.5 rounded-full">
                            正在招聘
                        </span>
                    </div>
                </div>
                
                <div class="px-5 py-4">
                    <div class="info-group mb-4">
                        <div class="info-item">
                            <i class="fa fa-money info-icon"></i>
                            <span class="info-text font-medium">${job.salary}</span>
                        </div>
                        <div class="info-item">
                            <i class="fa fa-map-marker info-icon"></i>
                            <span class="info-text">${job.location}</span>
                        </div>
                        <div class="info-item">
                            <i class="fa fa-user info-icon"></i>
                            <span class="info-text">${job.contactPerson}</span>
                        </div>
                        <div class="info-item">
                            <i class="fa fa-phone info-icon"></i>
                            <span class="info-text">${job.contactPhone}</span>
                        </div>
                        <div class="info-item col-span-2">
                            <i class="fa fa-calendar info-icon"></i>
                            <span class="info-text">有效期至: ${job.expiryDate}</span>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="section-title">岗位职责</h4>
                        <ul class="list-disc pl-5">${responsibilitiesList || '<li class="text-sm text-gray-500">暂无信息</li>'}</ul>
                    </div>
                    
                    <div>
                        <h4 class="section-title">岗位要求</h4>
                        <ul class="list-disc pl-5">${requirementsList || '<li class="text-sm text-gray-500">暂无信息</li>'}</ul>
                    </div>
                </div>
            `;

            return jobDiv;
        }

        // 滚动到页面顶部
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
